<div data-role="page" id="schoolbus-query">
<div data-role="header">
				<h1>校車動態查詢</h1>
				<a data-rel="back" data-direction="reverse" data-icon="back" class="ui-btn-left">回上頁</a>
</div>
<div data-role="content">
<ul data-role="listview" id="bus-info" data-inset="true" data-filter="false">
	<li>載入校車資訊中...</li>
</ul>
<script>

var busurl = 'http://210.71.64.85/project_lunch/schoolbus.php';

function busGet(){
	$.ajax({
		type: 'GET',
		dataType: 'json',
		url: busurl + '?bus=' + window.localStorage["bus"],
		timeout: 5000,
		success: function(data, textStatus ){
			var busQueryId = ['bus','lat','long','state','speed','utime','direction'];
			var busQueryName = ['路線','緯度','經度','狀態','速度','更新時間','方向'];
			content = '';
			busQueryId.forEach(function(element, index, array){
				content += '		<li><h3>' + busQueryName[index] + '：' + data[element] + '</h3></li>';
			});
			$('#bus-info').html(content);
			$('#bus-info').listview("refresh");
			if(content ==''){
				// no bus info returned
				$('#bus-info').html('<li><h3>出錯了 ( ˘･з･)</h3></li>');
				$('#bus-info').listview("refresh");
			}
		},
		error: function(xhr, textStatus, errorThrown){
			$('#bus-info').html('<li><h3>網路連線錯誤 &gt;&lt;</h3></li>');
			$('#bus-info').listview("refresh");
		}
	});
}

$(document).ready(function() {
	busGet();
	setInterval(busGet, 30000);
});

</script>
</div>
</div>
